<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Clay Machine Glow</title>
<link href="https://fonts.googleapis.com/css2?family=Lilita+One&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body { width: 100%; height: 100%; overflow: hidden; background: #1a1a2e; font-family: 'Segoe UI', sans-serif; touch-action: none; }

/* ===== TITLE SCREEN ===== */
#title-screen {
  position: fixed; inset: 0; z-index: 500;
  display: flex; align-items: center; justify-content: center;
  overflow: hidden;
  background: #0099cc;
}
.title-bg {
  position: absolute; inset: -40px;
  background: url('title-bg.png') center 40%;
  background-size: cover;
}

/* ---- White postcard ---- */
.title-card {
  position: relative; z-index: 2;
  background: #fafaf7;
  padding: 18px 30px 18px 30px;
  transform: rotate(8deg);
  box-shadow:
    -3px 5px 10px rgba(0,0,0,0.25),
    -1px 2px 4px rgba(0,0,0,0.12),
    0 0 0 1px rgba(0,0,0,0.04);
  max-width: 420px; width: 80vw;
  text-align: center;
  /* Subtle paper texture */
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4'%3E%3Crect width='4' height='4' fill='%23fafaf7'/%3E%3Crect x='0' y='0' width='1' height='1' fill='%23f5f5f0' opacity='0.3'/%3E%3C/svg%3E");
}

/* ---- Postmark stamps ---- */
.title-stamps {
  display: flex; justify-content: center; align-items: flex-end; gap: 4px;
  margin-bottom: 8px;
}
.stamp {
  width: 66px; height: 66px;
  position: relative;
  opacity: 0.6;
}
.stamp:nth-child(1) { transform: rotate(-6deg); }
.stamp:nth-child(2) { transform: rotate(3deg); }
.stamp:nth-child(3) { transform: rotate(-2deg); }
.stamp svg { width: 100%; height: 100%; }

/* ---- Postage stamp (4th) ---- */
.stamp-postage {
  width: 68px; height: 80px;
  background: #d8e4f8;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  position: relative;
  padding: 4px;
  /* Perforated edge via radial gradient mask */
  -webkit-mask-image: radial-gradient(circle 3px at 3px 0, transparent 2.5px, black 3px),
    radial-gradient(circle 3px at 3px 0, transparent 2.5px, black 3px),
    radial-gradient(circle 3px at 0 3px, transparent 2.5px, black 3px),
    radial-gradient(circle 3px at 0 3px, transparent 2.5px, black 3px),
    linear-gradient(black, black);
  -webkit-mask-size: 6px 4px, 6px 4px, 4px 6px, 4px 6px, calc(100% - 6px) calc(100% - 6px);
  -webkit-mask-position: top left, bottom left, top left, top right, 3px 3px;
  -webkit-mask-repeat: repeat-x, repeat-x, repeat-y, repeat-y, no-repeat;
  -webkit-mask-composite: source-over;
  mask-composite: add;
  transform: rotate(5deg);
}
.stamp-postage img {
  width: 50px; height: 54px;
  object-fit: contain;
}
.stamp-postage-top,
.stamp-postage-bottom {
  font-family: 'Lilita One', sans-serif;
  font-size: 6px;
  color: #2a3a6a;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  line-height: 1;
}

/* ---- Title typography ---- */
.title-line1 {
  font-family: 'Lilita One', sans-serif;
  font-size: clamp(32px, 8.5vw, 56px);
  color: #2952a3;
  line-height: 1;
  letter-spacing: 2px;
}
.title-line2 {
  font-family: 'Lilita One', sans-serif;
  font-size: clamp(36px, 9.5vw, 64px);
  color: #2952a3;
  line-height: 0.95;
  letter-spacing: 2px;
}
.title-line3 {
  font-family: 'Lilita One', sans-serif;
  font-size: clamp(44px, 12vw, 80px);
  color: #d41920;
  line-height: 0.95;
  letter-spacing: 3px;
}

/* ---- Author strip ---- */
.title-author {
  margin-top: 10px;
  display: flex; align-items: center; justify-content: center; gap: 8px;
}
.title-author-line { height: 2.5px; width: 32px; background: #222; }
.title-author-name {
  font-family: 'Segoe UI', Helvetica, Arial, sans-serif;
  font-size: 12px; font-weight: 900;
  color: #222; letter-spacing: 3.5px;
  text-transform: uppercase;
}

/* ---- Yellow O circle â€” random position on page ---- */
.title-yellow-circle {
  position: fixed;
  width: 68px; height: 68px;
  border: 6px solid #e8b800;
  border-radius: 50%;
  z-index: 3;
  display: flex; align-items: center; justify-content: center;
  background: transparent;
}
.title-yellow-circle img {
  width: 42px; height: 42px;
  object-fit: contain;
}

/* ---- Red badge â€” top left of COVER ---- */
.title-badge {
  position: absolute;
  top: 10px; left: 10px;
  width: 62px; height: 62px;
  border-radius: 50%;
  background: #cc1111;
  border: 3px solid #fff;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  box-shadow: 1px 2px 6px rgba(0,0,0,0.35);
  z-index: 10;
}
.title-badge svg { width: 100%; height: 100%; }

/* ---- Start button ---- */
#start-btn {
  position: relative; z-index: 3;
  margin-top: 22px;
  padding: 10px 44px;
  font-family: 'Lilita One', sans-serif;
  font-size: 26px;
  letter-spacing: 2px;
  background: #e8b800;
  color: #1a1a2e;
  border: 3px solid #222;
  border-radius: 50px;
  cursor: pointer;
  box-shadow: 3px 4px 0 #222;
  transition: transform 0.1s, box-shadow 0.1s;
}
#start-btn:active {
  transform: translateY(3px);
  box-shadow: 0 1px 0 #222;
}

#game-container { position: relative; width: 100%; height: 100%; overflow: hidden; cursor: grab; }
#game-container.dragging { cursor: grabbing; }

#scene-canvas { position: absolute; top: 0; left: 0; image-rendering: auto; }

#hud { position: fixed; top: 0; left: 0; right: 0; z-index: 100; display: none; display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background: linear-gradient(180deg, rgba(0,0,0,0.7) 0%, transparent 100%); pointer-events: none; }
#hud .scene-name { color: #fff; font-size: 18px; font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
#hud .timer { color: #ffd700; font-size: 22px; font-weight: 700; font-variant-numeric: tabular-nums; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }

#hint-btn { position: fixed; bottom: 20px; right: 20px; z-index: 100; display: none; background: rgba(0,0,0,0.5); color: #ffd700; border: 2px solid #ffd700; border-radius: 50%; width: 44px; height: 44px; font-size: 20px; cursor: pointer; }

.click-feedback { position: absolute; pointer-events: none; z-index: 50; animation: feedbackFade 0.6s ease-out forwards; }
@keyframes feedbackFade { 0% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: scale(1.5); } }

.found-pulse { position: absolute; pointer-events: none; z-index: 50; border: 3px solid #ffd700; border-radius: 50%; animation: pulse 0.8s ease-out forwards; }
@keyframes pulse { 0% { opacity: 1; transform: scale(1); box-shadow: 0 0 20px #ffd700; } 50% { opacity: 1; transform: scale(1.2); box-shadow: 0 0 40px #ffd700; } 100% { opacity: 0; transform: scale(1.5); } }

#found-banner { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 200; color: #ffd700; font-size: 64px; font-weight: 900; text-shadow: 0 0 30px rgba(255,215,0,0.8), 0 4px 8px rgba(0,0,0,0.5); opacity: 0; pointer-events: none; transition: opacity 0.3s; }
#found-banner.show { opacity: 1; animation: bannerPop 1.2s ease-out; }
@keyframes bannerPop { 0% { transform: translate(-50%,-50%) scale(0.5); } 30% { transform: translate(-50%,-50%) scale(1.2); } 100% { transform: translate(-50%,-50%) scale(1); } }

#end-screen { position: fixed; inset: 0; z-index: 300; background: rgba(10,10,30,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; color: #fff; }
#end-screen h1 { font-size: 48px; color: #ffd700; margin-bottom: 20px; }
#end-screen .times { font-size: 20px; line-height: 2; }
#end-screen .total { font-size: 28px; color: #ffd700; margin-top: 20px; font-weight: 700; }
#end-screen button { margin-top: 30px; padding: 12px 40px; font-size: 20px; background: #ffd700; color: #1a1a2e; border: none; border-radius: 8px; cursor: pointer; font-weight: 700; }
</style>
</head>
<body>

<!-- TITLE SCREEN -->
<div id="title-screen">
  <div class="title-bg"></div>

  <!-- Red badge â€” top left of COVER (like "Where's Waldo? Book One") -->
  <div class="title-badge">
    <svg viewBox="0 0 62 62">
      <circle cx="31" cy="31" r="28" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
      <text x="31" y="18" text-anchor="middle" font-family="'Lilita One',sans-serif" font-size="6" fill="#fff" letter-spacing="0.5">CLAY MACHINE</text>
      <text x="31" y="25" text-anchor="middle" font-family="'Lilita One',sans-serif" font-size="6" fill="#fff" letter-spacing="0.5">GLOW</text>
      <text x="31" y="47" text-anchor="middle" font-family="'Lilita One',sans-serif" font-size="22" fill="#ffd700">1</text>
    </svg>
  </div>

  <!-- Yellow circle with machine â€” randomly placed in crowd -->
  <div class="title-yellow-circle" id="title-yellow-circle"><img src="machine-sprite.png" alt=""></div>

  <div style="position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;">
    <div class="title-card">

      <!-- Postmark stamps row -->
      <div class="title-stamps">
        <div class="stamp">
          <svg viewBox="0 0 80 80">
            <circle cx="40" cy="40" r="37" fill="none" stroke="#555" stroke-width="2"/>
            <circle cx="40" cy="40" r="33" fill="none" stroke="#555" stroke-width="1"/>
            <circle cx="40" cy="40" r="29" fill="none" stroke="#555" stroke-width="0.5"/>
            <line x1="3" y1="40" x2="77" y2="40" stroke="#555" stroke-width="0.7"/>
            <path id="p1t" d="M10,38 A30,30 0 0,1 70,38" fill="none"/>
            <path id="p1b" d="M70,42 A30,30 0 0,1 10,42" fill="none"/>
            <text font-size="6.5" fill="#444" font-weight="700" font-family="sans-serif"><textPath href="#p1t" startOffset="50%" text-anchor="middle">FIND THE</textPath></text>
            <text font-size="6.5" fill="#444" font-weight="700" font-family="sans-serif"><textPath href="#p1b" startOffset="50%" text-anchor="middle">MACHINE</textPath></text>
            <text x="40" y="42" text-anchor="middle" font-size="7" fill="#444" font-weight="800" font-family="sans-serif">KENSINGTON</text>
          </svg>
        </div>
        <div class="stamp">
          <svg viewBox="0 0 80 80">
            <circle cx="40" cy="40" r="37" fill="none" stroke="#555" stroke-width="2"/>
            <circle cx="40" cy="40" r="33" fill="none" stroke="#555" stroke-width="1"/>
            <circle cx="40" cy="40" r="29" fill="none" stroke="#555" stroke-width="0.5"/>
            <line x1="3" y1="40" x2="77" y2="40" stroke="#555" stroke-width="0.7"/>
            <path id="p2t" d="M10,38 A30,30 0 0,1 70,38" fill="none"/>
            <path id="p2b" d="M70,42 A30,30 0 0,1 10,42" fill="none"/>
            <text font-size="6.5" fill="#444" font-weight="700" font-family="sans-serif"><textPath href="#p2t" startOffset="50%" text-anchor="middle">FIND THE</textPath></text>
            <text font-size="6.5" fill="#444" font-weight="700" font-family="sans-serif"><textPath href="#p2b" startOffset="50%" text-anchor="middle">MACHINE</textPath></text>
            <text x="40" y="42" text-anchor="middle" font-size="6.5" fill="#444" font-weight="800" font-family="sans-serif">DUNDAS SQ</text>
          </svg>
        </div>
        <div class="stamp">
          <svg viewBox="0 0 80 80">
            <circle cx="40" cy="40" r="37" fill="none" stroke="#555" stroke-width="2"/>
            <circle cx="40" cy="40" r="33" fill="none" stroke="#555" stroke-width="1"/>
            <circle cx="40" cy="40" r="29" fill="none" stroke="#555" stroke-width="0.5"/>
            <line x1="3" y1="40" x2="77" y2="40" stroke="#555" stroke-width="0.7"/>
            <path id="p3t" d="M10,38 A30,30 0 0,1 70,38" fill="none"/>
            <path id="p3b" d="M70,42 A30,30 0 0,1 10,42" fill="none"/>
            <text font-size="6.5" fill="#444" font-weight="700" font-family="sans-serif"><textPath href="#p3t" startOffset="50%" text-anchor="middle">FIND THE</textPath></text>
            <text font-size="6.5" fill="#444" font-weight="700" font-family="sans-serif"><textPath href="#p3b" startOffset="50%" text-anchor="middle">MACHINE</textPath></text>
            <text x="40" y="42" text-anchor="middle" font-size="6" fill="#444" font-weight="800" font-family="sans-serif">DISTILLERY</text>
          </svg>
        </div>
        <!-- 4th: Rectangular postage stamp with machine portrait -->
        <div class="stamp-postage">
          <div class="stamp-postage-top">FIND THE</div>
          <img src="machine-sprite.png" alt="">
          <div class="stamp-postage-bottom">MACHINE</div>
        </div>
      </div>

      <!-- Title text -->
      <div class="title-line1">CLAY</div>
      <div class="title-line2">MACHINE</div>
      <div class="title-line3">GLOW</div>

      <!-- Author -->
      <div class="title-author">
        <div class="title-author-line"></div>
        <span class="title-author-name">Alan Gertner</span>
        <div class="title-author-line"></div>
      </div>

    </div>
    <button id="start-btn">START</button>
  </div>
</div>

<div id="hud">
  <div class="scene-name" id="scene-label"></div>
  <div class="timer" id="timer">0.0s</div>
</div>

<div id="game-container">
  <canvas id="scene-canvas"></canvas>
</div>

<button id="hint-btn" title="Hint">?</button>
<div id="found-banner">FOUND!</div>

<div id="end-screen">
  <h1>ðŸŽ‰ All Found!</h1>
  <div class="times" id="end-times"></div>
  <div class="total" id="end-total"></div>
  <button onclick="restartGame()">Play Again</button>
</div>

<script>
// Vending machine coordinates baked into the DALL-E generated images
// vendingX/vendingY = center of vending machine as fraction of image dimensions
const SCENES = [
  { img: 'scenes/scene1.png?v=4',  name: 'Kensington Market',      vendingX: 0.375, vendingY: 0.420 },
  { img: 'scenes/scene2.png?v=3',  name: 'Nathan Phillips Square', vendingX: 0.685, vendingY: 0.720 },
  { img: 'scenes/scene3.png?v=3',  name: 'Dundas Square',          vendingX: 0.335, vendingY: 0.550 },
  { img: 'scenes/scene4.png?v=3',  name: 'St. Lawrence Market',    vendingX: 0.335, vendingY: 0.480 },
  { img: 'scenes/scene5.png?v=3',  name: 'High Park',              vendingX: 0.445, vendingY: 0.410 },
  { img: 'scenes/scene6.png?v=3',  name: 'Toronto Islands',        vendingX: 0.275, vendingY: 0.635 },
  { img: 'scenes/scene7.png?v=3',  name: 'Chinatown Spadina',      vendingX: 0.415, vendingY: 0.420 },
  { img: 'scenes/scene8.png?v=3',  name: 'PATH Underground',       vendingX: 0.295, vendingY: 0.670 },
  { img: 'scenes/scene9.png?v=3',  name: 'Distillery District',    vendingX: 0.338, vendingY: 0.352 },
  { img: 'scenes/scene10.png?v=3', name: 'Gardiner Museum',        vendingX: 0.385, vendingY: 0.330 },
];

const HIT_RADIUS = 55; // generous hitbox radius in image pixels
let currentScene = 0, times = [], sceneStart = 0;
let canvas, ctx, container;
let imgObj = null, imgLoaded = false;
let panX = 0, panY = 0, scale = 1, minScale = 1;
let dragging = false, dragStartX, dragStartY, panStartX, panStartY;
let lastPinchDist = 0, found = false;

function init() {
  canvas = document.getElementById('scene-canvas');
  ctx = canvas.getContext('2d');
  container = document.getElementById('game-container');
  loadScene(0);
  setupInput();
  requestAnimationFrame(tick);
}

function loadScene(idx) {
  currentScene = idx;
  found = false;
  imgLoaded = false;
  document.getElementById('scene-label').textContent = SCENES[idx].name;
  sceneStart = performance.now();
  imgObj = new Image();
  imgObj.onload = () => {
    imgLoaded = true;
    canvas.width = imgObj.width;
    canvas.height = imgObj.height;
    const sx = container.clientWidth / imgObj.width;
    const sy = container.clientHeight / imgObj.height;
    minScale = Math.max(sx, sy);
    scale = minScale;
    panX = (container.clientWidth - imgObj.width * scale) / 2;
    panY = (container.clientHeight - imgObj.height * scale) / 2;
    clampPan();
  };
  imgObj.src = SCENES[idx].img;
}

function getVendingCenter() {
  const s = SCENES[currentScene];
  return {
    x: Math.floor(s.vendingX * imgObj.width),
    y: Math.floor(s.vendingY * imgObj.height)
  };
}

function render() {
  if (!imgLoaded) return;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(imgObj, 0, 0);
  canvas.style.transform = `translate(${panX}px, ${panY}px) scale(${scale})`;
  canvas.style.transformOrigin = '0 0';
}

function tick() {
  render();
  if (!found) {
    const elapsed = ((performance.now() - sceneStart) / 1000).toFixed(1);
    document.getElementById('timer').textContent = elapsed + 's';
  }
  requestAnimationFrame(tick);
}

function clampPan() {
  const w = imgObj.width * scale, h = imgObj.height * scale;
  const cw = container.clientWidth, ch = container.clientHeight;
  if (w <= cw) panX = (cw - w) / 2;
  else panX = Math.min(0, Math.max(cw - w, panX));
  if (h <= ch) panY = (ch - h) / 2;
  else panY = Math.min(0, Math.max(ch - h, panY));
}

function screenToImage(sx, sy) {
  return { x: (sx - panX) / scale, y: (sy - panY) / scale };
}

function handleClick(sx, sy) {
  if (found || !imgLoaded) return;
  const pt = screenToImage(sx, sy);
  const vc = getVendingCenter();
  const dist = Math.hypot(pt.x - vc.x, pt.y - vc.y);

  if (dist <= HIT_RADIUS) {
    found = true;
    const elapsed = (performance.now() - sceneStart) / 1000;
    times.push(elapsed);
    // pulse circle at machine location
    const el = document.createElement('div');
    el.className = 'found-pulse';
    const screenX = vc.x * scale + panX;
    const screenY = vc.y * scale + panY;
    const r = HIT_RADIUS * scale;
    el.style.left = (screenX - r) + 'px';
    el.style.top = (screenY - r) + 'px';
    el.style.width = (r * 2) + 'px';
    el.style.height = (r * 2) + 'px';
    container.appendChild(el);
    setTimeout(() => el.remove(), 1000);

    const banner = document.getElementById('found-banner');
    banner.classList.add('show');
    setTimeout(() => {
      banner.classList.remove('show');
      if (currentScene < SCENES.length - 1) {
        loadScene(currentScene + 1);
      } else {
        showEnd();
      }
    }, 1500);
  } else {
    const el = document.createElement('div');
    el.className = 'click-feedback';
    el.style.left = (sx - 15) + 'px';
    el.style.top = (sy - 15) + 'px';
    el.style.width = '30px';
    el.style.height = '30px';
    el.style.fontSize = '24px';
    el.style.textAlign = 'center';
    el.style.lineHeight = '30px';
    el.style.color = '#ff4444';
    el.textContent = 'âœ•';
    container.appendChild(el);
    setTimeout(() => el.remove(), 600);
  }
}

function showEnd() {
  const end = document.getElementById('end-screen');
  end.style.display = 'flex';
  const timesDiv = document.getElementById('end-times');
  timesDiv.innerHTML = times.map((t, i) => `${SCENES[i].name}: ${t.toFixed(1)}s`).join('<br>');
  const total = times.reduce((a, b) => a + b, 0);
  document.getElementById('end-total').textContent = `Total: ${total.toFixed(1)}s`;
}

function restartGame() {
  document.getElementById('end-screen').style.display = 'none';
  times = [];
  loadScene(0);
}

function setupInput() {
  let clickIntent = true;
  container.addEventListener('mousedown', e => { dragging = true; clickIntent = true; dragStartX = e.clientX; dragStartY = e.clientY; panStartX = panX; panStartY = panY; container.classList.add('dragging'); });
  window.addEventListener('mousemove', e => { if (!dragging) return; const dx = e.clientX - dragStartX, dy = e.clientY - dragStartY; if (Math.abs(dx) > 5 || Math.abs(dy) > 5) clickIntent = false; panX = panStartX + dx; panY = panStartY + dy; clampPan(); });
  window.addEventListener('mouseup', e => { if (dragging && clickIntent) handleClick(e.clientX, e.clientY); dragging = false; container.classList.remove('dragging'); });

  container.addEventListener('wheel', e => {
    e.preventDefault();
    const oldScale = scale;
    scale *= e.deltaY < 0 ? 1.1 : 0.9;
    scale = Math.max(minScale, Math.min(4, scale));
    const rect = container.getBoundingClientRect();
    const mx = e.clientX - rect.left, my = e.clientY - rect.top;
    panX = mx - (mx - panX) * (scale / oldScale);
    panY = my - (my - panY) * (scale / oldScale);
    clampPan();
  }, { passive: false });

  // Touch
  let touches = [];
  container.addEventListener('touchstart', e => {
    e.preventDefault();
    touches = [...e.touches];
    if (touches.length === 1) { dragging = true; clickIntent = true; dragStartX = touches[0].clientX; dragStartY = touches[0].clientY; panStartX = panX; panStartY = panY; }
    if (touches.length === 2) { lastPinchDist = Math.hypot(touches[1].clientX - touches[0].clientX, touches[1].clientY - touches[0].clientY); clickIntent = false; }
  }, { passive: false });
  container.addEventListener('touchmove', e => {
    e.preventDefault();
    const ts = [...e.touches];
    if (ts.length === 1 && dragging) {
      const dx = ts[0].clientX - dragStartX, dy = ts[0].clientY - dragStartY;
      if (Math.abs(dx) > 5 || Math.abs(dy) > 5) clickIntent = false;
      panX = panStartX + dx; panY = panStartY + dy; clampPan();
    }
    if (ts.length === 2) {
      const dist = Math.hypot(ts[1].clientX - ts[0].clientX, ts[1].clientY - ts[0].clientY);
      const oldScale = scale;
      scale *= dist / lastPinchDist;
      scale = Math.max(minScale, Math.min(4, scale));
      const mx = (ts[0].clientX + ts[1].clientX) / 2, my = (ts[0].clientY + ts[1].clientY) / 2;
      panX = mx - (mx - panX) * (scale / oldScale);
      panY = my - (my - panY) * (scale / oldScale);
      clampPan();
      lastPinchDist = dist;
    }
  }, { passive: false });
  container.addEventListener('touchend', e => {
    if (dragging && clickIntent && e.changedTouches.length === 1) handleClick(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
    dragging = false;
  });

  // Hint - smoothly pan toward the vending machine
  document.getElementById('hint-btn').addEventListener('click', () => {
    if (found || !imgLoaded) return;
    const vc = getVendingCenter();
    const tx = -(vc.x * scale - container.clientWidth / 2);
    const ty = -(vc.y * scale - container.clientHeight / 2);
    panX += (tx - panX) * 0.3;
    panY += (ty - panY) * 0.3;
    clampPan();
  });
}

// ===== TITLE SCREEN =====
function initTitle() {
  // Place yellow circle randomly on page (avoiding center where card is)
  const yc = document.getElementById('title-yellow-circle');
  const margin = 80;
  const W = window.innerWidth, H = window.innerHeight;
  let x, y, attempts = 0;
  do {
    x = margin + Math.random() * (W - margin * 2 - 68);
    y = margin + Math.random() * (H - margin * 2 - 68);
    // Avoid the center card area (roughly middle 50% of screen)
    const inCenter = x > W * 0.2 && x < W * 0.75 && y > H * 0.15 && y < H * 0.8;
    if (!inCenter || attempts > 30) break;
    attempts++;
  } while (true);
  yc.style.left = x + 'px';
  yc.style.top = y + 'px';

  document.getElementById('start-btn').addEventListener('click', () => {
    document.getElementById('title-screen').style.display = 'none';
    document.getElementById('title-yellow-circle').style.display = 'none';
    document.getElementById('hud').style.display = 'flex';
    document.getElementById('hint-btn').style.display = 'block';
    init();
  });
}

window.addEventListener('load', initTitle);
window.addEventListener('resize', () => { if (imgLoaded) clampPan(); });
</script>
</body>
</html>
